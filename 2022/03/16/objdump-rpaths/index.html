<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width; initial-scale=1.0;" />
  
    <title>Printing rpaths with objdump - Keith Smiley</title>
  

    <meta name="author" content="Keith Smiley">
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml">

    <link rel="icon" href="/images/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">

    <link rel="stylesheet" type="text/css" href="/css/style.css" title="default">
  </head>
  <body>
    <section class="container">
      <div id="masthead">
        <h1>
          <a href="/">Keith Smiley</a>
          | <a href="https://www.keith.so">About</a>
          | <a href="/atom.xml">RSS</a>
        </h1>
      </div>

      <section class="content">
        <article>
  <header class="seven columns">
    
      <h1 class="title">Printing rpaths with objdump</h1>
    
    <p class="date">
      <time datetime="2022-03-16 10:00:00 -0700" pubdate="pubdate">
        16 Mar 2022
      </time>
      <a class="permalink" title="Permalink" href="/2022/03/16/objdump-rpaths/">&infin;</a>
    </p>
  </header>

  <div class="post ten columns">
    <p>MachO binaries contain load commands to indicate to dyld where it should
search for the libraries the binary depends on.</p>

<p>These paths are often useful to inspect when debugging why your binary
isn't discovering the libraries you'd expect.</p>

<p>Previously you could discover these with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% otool -l `xcrun -f swiftc` \
  | grep -A2 LC_RPATH \
  | grep "^\s*path" \
  | cut -d " " -f 11
@executable_path/../lib/swift/macosx
@executable_path/../lib/swift/macosx
</code></pre></div></div>

<p>This example is quite verbose and fragile for such a common action, so
recently I <a href="https://reviews.llvm.org/D100681">committed a change</a> to add an easier option with
LLVM's <code class="language-plaintext highlighter-rouge">objdump</code>. This change shipped with LLVM 13 or Xcode 13.3 on
macOS, allowing you to run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% objdump --macho --rpaths `xcrun -f swiftc`
/Applications/Xcode-13.3.0.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swiftc:
@executable_path/../lib/swift/macosx
</code></pre></div></div>

<p>This is much more succinct and memorable, but also has slightly
different output. This is because <code class="language-plaintext highlighter-rouge">objdump</code> automatically detects the
current machine's architecture, and only prints the rpaths for that
slice of the fat binary. It also outputs the path of the binary being
run on, which you can disable with <code class="language-plaintext highlighter-rouge">--no-leading-headers</code>.</p>

<p>Hopefully you find this as useful as I do!</p>


  </div>
</article>

      </section>
    </section>
  </body>
</html>
